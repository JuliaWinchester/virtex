// virtex v0.2.7 https://github.com/edsilv/virtex#readme
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.virtex=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var Virtex,__extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)},requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,5)}}();!function(Virtex){var Viewport=function(_super){function Viewport(options){_super.call(this,options),this._isFullscreen=!1,this._isMouseDown=!1,this._isVRMode=!1,this._mouseX=0,this._mouseXOnMouseDown=0,this._mouseY=0,this._mouseYOnMouseDown=0,this._pinchStart=new THREE.Vector2,this._targetRotationOnMouseDownX=0,this._targetRotationOnMouseDownY=0,this._targetRotationX=0,this._targetRotationY=0,this._vrEnabled=!0;var success=this._init();this._resize(),success&&this._draw()}return __extends(Viewport,_super),Viewport.prototype._init=function(){var success=_super.prototype._init.call(this);return success?Detector.webgl?(window.WebVRConfig=this.options.webVRConfig,this.options.fullscreenEnabled||(this._vrEnabled=!1),this._$element.append('<div class="viewport"></div><div class="loading"><div class="bar"></div></div>'),this._$viewport=this._$element.find(".viewport"),this._$loading=this._$element.find(".loading"),this._$loadingBar=this._$loading.find(".bar"),this._$loading.hide(),this._scene=new THREE.Scene,this._objectGroup=new THREE.Object3D,this._scene.add(this._objectGroup),this._createLights(),this._createCamera(),this._createControls(),this._createRenderer(),this._createEventListeners(),this._loadObject(this.options.object),this.options.showStats&&(this._stats=new Stats,this._stats.domElement.style.position="absolute",this._stats.domElement.style.top="0px",this._$viewport.append(this._stats.domElement)),!0):(Detector.addGetWebGLMessage(),this._$oldie=$("#oldie"),this._$oldie.appendTo(this._$element),!1):(console.error("Virtex failed to initialise"),!1)},Viewport.prototype._getDefaultOptions=function(){return{ambientLightColor:13684944,cameraZ:4.5,directionalLight1Color:16777215,directionalLight1Intensity:.75,directionalLight2Color:10584,directionalLight2Intensity:.5,doubleSided:!0,fadeSpeed:1750,far:1e4,fov:45,maxZoom:10,minZoom:2,near:.1,fullscreenEnabled:!0,shading:THREE.SmoothShading,shininess:1,showStats:!1,vrBackgroundColor:0,webVRConfig:{DEFER_INITIALIZATION:!0,FORCE_ENABLE_VR:!0,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!0},zoomSpeed:1}},Viewport.prototype._getVRDisplay=function(){return new Promise(function(resolve,reject){navigator.getVRDisplays().then(function(devices){for(var i=0;i<devices.length;i++)if(devices[i]instanceof VRDisplay){resolve(devices[i]);break}resolve(null)},function(){resolve(null)})})},Viewport.prototype._createLights=function(){this._lightGroup=new THREE.Object3D,this._scene.add(this._lightGroup);var light1=new THREE.DirectionalLight(this.options.directionalLight1Color,this.options.directionalLight1Intensity);light1.position.set(1,1,1),this._lightGroup.add(light1);var light2=new THREE.DirectionalLight(this.options.directionalLight2Color,this.options.directionalLight2Intensity);light2.position.set(-1,-1,-1),this._lightGroup.add(light2);var ambientLight=new THREE.AmbientLight(this.options.ambientLightColor);this._lightGroup.add(ambientLight)},Viewport.prototype._createCamera=function(){this._camera=new THREE.PerspectiveCamera(this.options.fov,this._getWidth()/this._getHeight(),this.options.near,this.options.far),this._camera.position.z=this._targetZoom=this.options.cameraZ},Viewport.prototype._createRenderer=function(){this._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this._isVRMode?(this._renderer.setClearColor(this.options.vrBackgroundColor),this._vrEffect=new THREE.VREffect(this._renderer),this._vrEffect.setSize(this._$viewport.width(),this._$viewport.height())):(this._renderer.setClearColor(this.options.vrBackgroundColor,0),this._renderer.setSize(this._$viewport.width(),this._$viewport.height())),this._$viewport.empty().append(this._renderer.domElement)},Viewport.prototype._createControls=function(){this._isVRMode&&(this._vrControls=new THREE.VRControls(this._camera))},Viewport.prototype._createEventListeners=function(){var _this=this;this.options.fullscreenEnabled&&$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){_this._fullscreenChanged()}),this._$element.on("mousedown",function(e){_this._onMouseDown(e.originalEvent)}),this._$element.on("mousemove",function(e){_this._onMouseMove(e.originalEvent)}),this._$element.on("mouseup",function(e){_this._onMouseUp(e.originalEvent)}),this._$element.on("mouseout",function(e){_this._onMouseOut(e.originalEvent)}),this._$element.on("mousewheel",function(e){_this._onMouseWheel(e.originalEvent)}),this._$element.on("DOMMouseScroll",function(e){_this._onMouseWheel(e.originalEvent)}),this._$element.on("touchstart",function(e){_this._onTouchStart(e.originalEvent)}),this._$element.on("touchmove",function(e){_this._onTouchMove(e.originalEvent)}),this._$element.on("touchend",function(e){_this._onTouchEnd(e.originalEvent)}),window.addEventListener("resize",function(){return _this._resize()},!1)},Viewport.prototype._loadObject=function(object){var _this=this;this._$loading.show();var loader=new THREE.ObjectLoader;loader.setCrossOrigin("anonymous"),loader.load(object,function(obj){_this.options.doubleSided&&obj.traverse(function(child){child.material&&(child.material.side=THREE.DoubleSide)}),_this._objectGroup.add(obj),_this._$loading.fadeOut(_this.options.fadeSpeed),_this._emit(Virtex.Events.LOADED,obj)},function(e){e.lengthComputable&&_this._loadProgress(e.loaded/e.total)},function(e){console.log(e)})},Viewport.prototype._loadProgress=function(progress){var fullWidth=this._$loading.width(),width=Math.floor(fullWidth*progress);this._$loadingBar.width(width)},Viewport.prototype._fullscreenChanged=function(){this._isFullscreen?(this.exitFullscreen(),this.exitVRMode(),this._$element.width(this._lastWidth),this._$element.height(this._lastHeight)):(this._lastWidth=this._getWidth(),this._lastHeight=this._getHeight()),this._isFullscreen=!this._isFullscreen,this._resize()},Viewport.prototype._onMouseDown=function(event){event.preventDefault(),this._isMouseDown=!0,this._mouseXOnMouseDown=event.clientX-this._viewportHalfX,this._targetRotationOnMouseDownX=this._targetRotationX,this._mouseYOnMouseDown=event.clientY-this._viewportHalfY,this._targetRotationOnMouseDownY=this._targetRotationY},Viewport.prototype._onMouseMove=function(event){this._mouseX=event.clientX-this._viewportHalfX,this._mouseY=event.clientY-this._viewportHalfY,this._isMouseDown&&(this._targetRotationY=this._targetRotationOnMouseDownY+.02*(this._mouseY-this._mouseYOnMouseDown),this._targetRotationX=this._targetRotationOnMouseDownX+.02*(this._mouseX-this._mouseXOnMouseDown))},Viewport.prototype._onMouseUp=function(event){this._isMouseDown=!1},Viewport.prototype._onMouseOut=function(event){this._isMouseDown=!1},Viewport.prototype._onMouseWheel=function(event){event.preventDefault(),event.stopPropagation();var delta=0;void 0!==event.wheelDelta?delta=event.wheelDelta:void 0!==event.detail&&(delta=-event.detail),delta>0?this.zoomIn():0>delta&&this.zoomOut()},Viewport.prototype._onTouchStart=function(event){var touches=event.touches;1===touches.length&&(this._isMouseDown=!0,event.preventDefault(),this._mouseXOnMouseDown=touches[0].pageX-this._viewportHalfX,this._targetRotationOnMouseDownX=this._targetRotationX,this._mouseYOnMouseDown=touches[0].pageY-this._viewportHalfY,this._targetRotationOnMouseDownY=this._targetRotationY)},Viewport.prototype._onTouchMove=function(event){event.preventDefault(),event.stopPropagation();var touches=event.touches;switch(touches.length){case 1:event.preventDefault(),this._mouseX=touches[0].pageX-this._viewportHalfX,this._targetRotationX=this._targetRotationOnMouseDownX+.05*(this._mouseX-this._mouseXOnMouseDown),this._mouseY=touches[0].pageY-this._viewportHalfY,this._targetRotationY=this._targetRotationOnMouseDownY+.05*(this._mouseY-this._mouseYOnMouseDown);break;case 2:var dx=touches[0].pageX-touches[1].pageX,dy=touches[0].pageY-touches[1].pageY,distance=Math.sqrt(dx*dx+dy*dy),pinchEnd=new THREE.Vector2(0,distance),pinchDelta=new THREE.Vector2;pinchDelta.subVectors(pinchEnd,this._pinchStart),pinchDelta.y>0?this.zoomIn():pinchDelta.y<0&&this.zoomOut(),this._pinchStart.copy(pinchEnd);break;case 3:}},Viewport.prototype._onTouchEnd=function(event){this._isMouseDown=!1},Viewport.prototype._draw=function(){var _this=this;requestAnimFrame(function(){return _this._draw()}),this._render(),this.options.showStats&&this._stats.update()},Viewport.prototype.rotateY=function(radians){var rotation=this._objectGroup.rotation.y+radians;this._objectGroup.rotation.y=rotation},Viewport.prototype._render=function(){if(this._isVRMode)this._isMouseDown&&this.rotateY(.1),this._vrControls.update(),this._scene instanceof Array?this._vrEffect.render(this._scene[0],this._camera):this._vrEffect.render(this._scene,this._camera);else{this.rotateY(.1*(this._targetRotationX-this._objectGroup.rotation.y));var finalRotationY=this._targetRotationY-this._objectGroup.rotation.x;this._objectGroup.rotation.x<=1&&this._objectGroup.rotation.x>=-1&&(this._objectGroup.rotation.x+=.1*finalRotationY),this._objectGroup.rotation.x>1?this._objectGroup.rotation.x=1:this._objectGroup.rotation.x<-1&&(this._objectGroup.rotation.x=-1);var zoomDelta=.1*(this._targetZoom-this._camera.position.z);this._camera.position.z+=zoomDelta,this._renderer.render(this._scene,this._camera)}},Viewport.prototype._getWidth=function(){return this._isFullscreen?window.innerWidth:this._$element.width()},Viewport.prototype._getHeight=function(){return this._isFullscreen?window.innerHeight:this._$element.height()},Viewport.prototype.zoomIn=function(){var t=this._camera.position.z-this.options.zoomSpeed;t>this.options.minZoom?this._targetZoom=t:this._targetZoom=this.options.minZoom},Viewport.prototype.zoomOut=function(){var t=this._camera.position.z+this.options.zoomSpeed;t<this.options.maxZoom?this._targetZoom=t:this._targetZoom=this.options.maxZoom},Viewport.prototype.enterVRMode=function(){var _this=this;this._vrEnabled&&(this._hmd?this._completeVRMode():this._getVRDisplay().then(function(display){display?(_this._hmd=display,_this._completeVRMode()):console.warn("hmd not found")}))},Viewport.prototype._completeVRMode=function(){this._isVRMode=!0,this._hmd.requestPresent({source:this._$viewport.find("canvas")[0]}),this._createControls(),this._createRenderer(),this.enterFullscreen()},Viewport.prototype.exitVRMode=function(){this._vrEnabled&&(this._isVRMode=!1,this._createCamera(),this._createRenderer())},Viewport.prototype.enterFullscreen=function(){if(this.options.fullscreenEnabled){var elem=this._$element[0],requestFullScreen=this._getRequestFullScreen(elem);requestFullScreen&&requestFullScreen.call(elem)}},Viewport.prototype.exitFullscreen=function(){var exitFullScreen=this._getExitFullScreen();exitFullScreen&&exitFullScreen.call(document)},Viewport.prototype._getRequestFullScreen=function(elem){return elem.requestFullscreen?elem.requestFullscreen:elem.msRequestFullscreen?elem.msRequestFullscreen:elem.mozRequestFullScreen?elem.mozRequestFullScreen:elem.webkitRequestFullscreen?elem.webkitRequestFullscreen:!1},Viewport.prototype._getExitFullScreen=function(){return document.exitFullscreen?document.exitFullscreen:document.msExitFullscreen?document.msExitFullscreen:document.mozCancelFullScreen?document.mozCancelFullScreen:document.webkitExitFullscreen?document.webkitExitFullscreen:!1},Viewport.prototype._resize=function(){this._$element&&this._$viewport?(this._$element.width(this._getWidth()),this._$element.height(this._getHeight()),this._$viewport.width(this._getWidth()),this._$viewport.height(this._getHeight()),this._viewportHalfX=this._$viewport.width()/2,this._viewportHalfY=this._$viewport.height()/2,this._camera.aspect=this._$viewport.width()/this._$viewport.height(),this._camera.updateProjectionMatrix(),this._isVRMode?this._vrEffect.setSize(this._$viewport.width(),this._$viewport.height()):this._renderer.setSize(this._$viewport.width(),this._$viewport.height()),this._$loading.css({left:this._viewportHalfX-this._$loading.width()/2,top:this._viewportHalfY-this._$loading.height()/2})):this._$oldie&&this._$oldie.css({left:this._$element.width()/2-this._$oldie.outerWidth()/2,top:this._$element.height()/2-this._$oldie.outerHeight()/2})},Viewport}(Components.BaseComponent);Virtex.Viewport=Viewport}(Virtex||(Virtex={}));var Virtex;!function(Virtex){var Events=function(){function Events(){}return Events.LOADED="loaded",Events}();Virtex.Events=Events}(Virtex||(Virtex={})),function(w){w.Virtex||(w.Virtex=Virtex)}(window)},{}]},{},[1])(1)});